#include <stdint.h>
#include <dlfcn.h>
#include "log.h"

void initHook(Server* server)
{
	theServer = server;

	void* handle = dlopen("libGLESv2.so", RTLD_LAZY);

	#define GET_DLSYM(func) glPointers.func = (PFN_##func)dlsym(handle, STRINGIFY(func)); \
							if (glPointers.func) LOGI("dlsym OK: %s", STRINGIFY(func)); \
							else LOGE("dlsym FAILED: %s", STRINGIFY(func));
	
	GET_DLSYM(glActiveTexture); GET_DLSYM(glAttachShader); GET_DLSYM(glBindAttribLocation); GET_DLSYM(glBindBuffer); GET_DLSYM(glBindFramebuffer); GET_DLSYM(glBindRenderbuffer); GET_DLSYM(glBindTexture); GET_DLSYM(glBlendColor); GET_DLSYM(glBlendEquation); GET_DLSYM(glBlendEquationSeparate); GET_DLSYM(glBlendFunc); GET_DLSYM(glBlendFuncSeparate); GET_DLSYM(glBufferData); GET_DLSYM(glBufferSubData); GET_DLSYM(glCheckFramebufferStatus); GET_DLSYM(glClear); GET_DLSYM(glClearColor); GET_DLSYM(glClearDepthf); GET_DLSYM(glClearStencil); GET_DLSYM(glColorMask); GET_DLSYM(glCompileShader); GET_DLSYM(glCompressedTexImage2D); GET_DLSYM(glCompressedTexSubImage2D); GET_DLSYM(glCopyTexImage2D); GET_DLSYM(glCopyTexSubImage2D); GET_DLSYM(glCreateProgram); GET_DLSYM(glCreateShader); GET_DLSYM(glCullFace); GET_DLSYM(glDeleteBuffers); GET_DLSYM(glDeleteFramebuffers); GET_DLSYM(glDeleteProgram); GET_DLSYM(glDeleteRenderbuffers); GET_DLSYM(glDeleteShader); GET_DLSYM(glDeleteTextures); GET_DLSYM(glDepthFunc); GET_DLSYM(glDepthMask); GET_DLSYM(glDepthRangef); GET_DLSYM(glDetachShader); GET_DLSYM(glDisable); GET_DLSYM(glDisableVertexAttribArray); GET_DLSYM(glDrawArrays); GET_DLSYM(glDrawElements); GET_DLSYM(glEnable); GET_DLSYM(glEnableVertexAttribArray); GET_DLSYM(glFinish); GET_DLSYM(glFlush); GET_DLSYM(glFramebufferRenderbuffer); GET_DLSYM(glFramebufferTexture2D); GET_DLSYM(glFrontFace); GET_DLSYM(glGenBuffers); GET_DLSYM(glGenerateMipmap); GET_DLSYM(glGenFramebuffers); GET_DLSYM(glGenRenderbuffers); GET_DLSYM(glGenTextures); GET_DLSYM(glGetActiveAttrib); GET_DLSYM(glGetActiveUniform); GET_DLSYM(glGetAttachedShaders); GET_DLSYM(glGetAttribLocation); GET_DLSYM(glGetBooleanv); GET_DLSYM(glGetBufferParameteriv); GET_DLSYM(glGetError); GET_DLSYM(glGetFloatv); GET_DLSYM(glGetFramebufferAttachmentParameteriv); GET_DLSYM(glGetIntegerv); GET_DLSYM(glGetProgramiv); GET_DLSYM(glGetProgramInfoLog); GET_DLSYM(glGetRenderbufferParameteriv); GET_DLSYM(glGetShaderiv); GET_DLSYM(glGetShaderInfoLog); GET_DLSYM(glGetShaderPrecisionFormat); GET_DLSYM(glGetShaderSource); GET_DLSYM(glGetString); GET_DLSYM(glGetTexParameterfv); GET_DLSYM(glGetTexParameteriv); GET_DLSYM(glGetUniformfv); GET_DLSYM(glGetUniformiv); GET_DLSYM(glGetUniformLocation); GET_DLSYM(glGetVertexAttribfv); GET_DLSYM(glGetVertexAttribiv); GET_DLSYM(glGetVertexAttribPointerv); GET_DLSYM(glHint); GET_DLSYM(glIsBuffer); GET_DLSYM(glIsEnabled); GET_DLSYM(glIsFramebuffer); GET_DLSYM(glIsProgram); GET_DLSYM(glIsRenderbuffer); GET_DLSYM(glIsShader); GET_DLSYM(glIsTexture); GET_DLSYM(glLineWidth); GET_DLSYM(glLinkProgram); GET_DLSYM(glPixelStorei); GET_DLSYM(glPolygonOffset); GET_DLSYM(glReadPixels); GET_DLSYM(glReleaseShaderCompiler); GET_DLSYM(glRenderbufferStorage); GET_DLSYM(glSampleCoverage); GET_DLSYM(glScissor); GET_DLSYM(glShaderBinary); GET_DLSYM(glShaderSource); GET_DLSYM(glStencilFunc); GET_DLSYM(glStencilFuncSeparate); GET_DLSYM(glStencilMask); GET_DLSYM(glStencilMaskSeparate); GET_DLSYM(glStencilOp); GET_DLSYM(glStencilOpSeparate); GET_DLSYM(glTexImage2D); GET_DLSYM(glTexParameterf); GET_DLSYM(glTexParameterfv); GET_DLSYM(glTexParameteri); GET_DLSYM(glTexParameteriv); GET_DLSYM(glTexSubImage2D); GET_DLSYM(glUniform1f); GET_DLSYM(glUniform1fv); GET_DLSYM(glUniform1i); GET_DLSYM(glUniform1iv); GET_DLSYM(glUniform2f); GET_DLSYM(glUniform2fv); GET_DLSYM(glUniform2i); GET_DLSYM(glUniform2iv); GET_DLSYM(glUniform3f); GET_DLSYM(glUniform3fv); GET_DLSYM(glUniform3i); GET_DLSYM(glUniform3iv); GET_DLSYM(glUniform4f); GET_DLSYM(glUniform4fv); GET_DLSYM(glUniform4i); GET_DLSYM(glUniform4iv); GET_DLSYM(glUniformMatrix2fv); GET_DLSYM(glUniformMatrix3fv); GET_DLSYM(glUniformMatrix4fv); GET_DLSYM(glUseProgram); GET_DLSYM(glValidateProgram); GET_DLSYM(glVertexAttrib1f); GET_DLSYM(glVertexAttrib1fv); GET_DLSYM(glVertexAttrib2f); GET_DLSYM(glVertexAttrib2fv); GET_DLSYM(glVertexAttrib3f); GET_DLSYM(glVertexAttrib3fv); GET_DLSYM(glVertexAttrib4f); GET_DLSYM(glVertexAttrib4fv); GET_DLSYM(glVertexAttribPointer); GET_DLSYM(glViewport); GET_DLSYM(glMapBufferOES); GET_DLSYM(glUnmapBufferOES);
	
	handle = dlopen("libGLESv3.so", RTLD_LAZY);
	GET_DLSYM(glTexStorage2D);
}
